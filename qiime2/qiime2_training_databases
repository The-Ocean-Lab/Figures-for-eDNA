Training a Classifier - 18S SILVA

# based on qiime2 forum instructions

qiime tools import \
  --type 'FeatureData[Sequence]' \
  --input-path /Users/drocean/Desktop/16S_18S_silva/SILVA_138.2_SSURef_NR99_tax_silva_trunc.fasta \
  --output-path silva-138-ssu-ref-seqs-rna.qza
                                                   # takes a database in fasta file form and turns it into a .qza so qiime2 can read it
workdir="/Users/drocean/Desktop/classifer"        # change the working directory to a new folder called classifier
cd $workdir
conda install -c bioconda -c conda-forge q2-rescript  
                                                   # install tools to help change the database from rna.qza to dna.qza
qiime rescript reverse-transcribe \
  --i-rna-sequences silva-138-ssu-ref-seqs-rna.qza \
  --o-dna-sequences silva-138-ssu-ref-seqs-dna.qza
                                                   # rna.qza to dna.qza
qiime rescript get-silva-data \
  --p-version 138 \
  --p-target SSURef_NR99 \
  --p-include-species-labels \
  --o-silva-sequences silva-138-ssu-nr99-seqs.qza \
  --o-silva-taxonomy silva-138-ssu-nr99-tax.qza
                                                  # uses database to create a .qza file with the taxonomy seq and the taxonomy name
qiime rescript dereplicate \
  --i-sequences silva-138-ssu-ref-seqs-dna.qza \
  --i-taxa silva-138-ssu-nr99-tax.qza \
  --p-mode 'uniq' \
  --o-dereplicated-sequences silva-138.0-ssu-nr99-seqs-derep-uniq.qza \
  --o-dereplicated-taxa silva-138.0-ssu-nr99-tax-derep-uniq.qza
                                                 # gets rid of duplicate seqs
qiime feature-classifier extract-reads \
    --i-sequences silva-138.0-ssu-nr99-seqs-derep-uniq.qza \
    --p-f-primer AATGATACGGCGACCACCGAGATCTACAC \
    --p-r-primer TGATCCTTCTGCAGGTTCACCTAC \
    --p-n-jobs 8 \
    --p-read-orientation 'forward' \
    --o-reads silva-132.0-ssu-nr99-seqs-F04-R22.qza
                                                # XXXX
qiime feature-classifier fit-classifier-naive-bayes \
  --i-reference-reads silva-132.0-ssu-nr99-seqs-F04-R22.qza \
  --i-reference-taxonomy silva-138.0-ssu-nr99-tax-derep-uniq.qza \
  --o-classifier silva-138-F04-R22-classifier.qza
                                                # training the classifer


EURKAYOME 18S Database

workdir="/Users/drocean/Desktop/classifer_database_18S/EUKARYOME_1_9_4"
cd "$workdir"

qiime tools import \
  --type 'FeatureData[Sequence]' \
  --input-path /Users/drocean/Desktop/classifer_databse_18S/EUKARYOME_1_9_4/QIIME2_EUK_SSU_v1.9.4.fasta \
  --output-path eukaryome-194-ssu-ref-seqs-dna.qza
                                                # already is dna sequences not rna
  
qiime tools import \
  --type 'FeatureData[Taxonomy]' \
  --input-format HeaderlessTSVTaxonomyFormat \
  --input-path /Users/drocean/Desktop/classifer_databse_18S/EUKARYOME_1_9_4/QIIME2_EUK_SSU_v1.9.4.tsv \
  --output-path eukaryome-194-ssu-ref-taxonomy.qza
  
qiime rescript dereplicate \
  --i-sequences eukaryome-194-ssu-ref-seqs-dna.qza \
  --i-taxa eukaryome-194-ssu-ref-taxonomy.qza \
  --p-mode 'uniq' \
  --o-dereplicated-sequences eukaryome-194-ssu-ref-seqs-derep-uniq.qza \
  --o-dereplicated-taxa eukaryome-194-ssu-tax-derep-uniq.qza

qiime feature-classifier extract-reads \
    --i-sequences eukaryome-194-ssu-ref-seqs-derep-uniq.qza \
    --p-f-primer AATGATACGGCGACCACCGAGATCTACAC \
    --p-r-primer TGATCCTTCTGCAGGTTCACCTAC \
    --p-n-jobs 8 \
    --p-read-orientation 'forward' \
    --o-reads silva-132.0-ssu-nr99-seqs-F04-R22.qza

qiime feature-classifier fit-classifier-naive-bayes \
  --i-reference-reads eukaryome-194-ssu-ref-seqs-F04-R22.qza \
  --i-reference-taxonomy eukaryome-194-ssu-ref-taxonomy.qza \
  --o-classifier eukaryome-194-F04-R22-classifier.qza
